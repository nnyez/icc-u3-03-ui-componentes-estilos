import{e as Ce,f as Se,h as Ee,i as ae,j as Pe,k as re,l as ke,n as ye,p as Te,q as we,r as W}from"./chunk-7T4TD45U.js";import{a as Ne,b as se,c as De,d as Me,e as Ve,f as Ae,g as Ie,h as Be,i as je}from"./chunk-TNZN56QU.js";import{a as Re}from"./chunk-MZF3CUCU.js";import{e as he,h as U,l as Fe,n as I}from"./chunk-QOGA6DDO.js";import{j as xe}from"./chunk-YWZJFH4M.js";import{Ab as a,Bb as S,C as z,Ca as $,Cb as M,Db as ge,Ea as ce,Fa as r,Fb as y,Gb as A,Hb as _e,Mb as O,Nb as fe,Ob as oe,P as q,Pb as be,Tb as T,Ua as C,V as H,_ as F,a as ie,b as ne,da as b,db as u,ea as x,eb as v,fa as w,fb as de,ga as R,gb as N,hb as D,ib as f,jb as l,kb as o,lb as h,mb as c,na as _,nb as d,ob as L,p as V,pb as k,q as P,qb as pe,rb as g,sb as ue,tb as m,u as j,yb as G,zb as ve}from"./chunk-AKAGUU27.js";var Y=class i{activatedRoute=F(he);currentPage=Fe(this.activatedRoute.queryParamMap.pipe(j(t=>t.get("page")?+t.get("page"):1),j(t=>isNaN(t)?1:t)),{initialValue:1});static \u0275fac=function(e){return new(e||i)};static \u0275prov=H({token:i,factory:i.\u0275fac,providedIn:"root"})};var le=()=>[],me=i=>({page:i});function qe(i,t){if(i&1){let e=k();l(0,"button",3),g("click",function(){let s=b(e).$implicit,p=m();return x(p.activePage.set(s))}),a(1),o()}if(i&2){let e=t.$implicit,n=m();G("btn-primary",e===n.activePage()),f("routerLink",y(5,le))("queryParams",A(6,me,e)),r(),M(" ",e," ")}}var J=class i{pages=T(0);currentPage=T(1);activePage=be(this.currentPage);getPagesList=fe(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(p,E)=>E+1);let n=Math.max(1,e-2),s=Math.min(t,n+4);return Array.from({length:s-n+1},(p,E)=>n+E)});previousPage(){this.activePage()>1&&this.activePage.update(t=>t-1)}nextPage(){this.activePage()<this.pages()&&this.activePage.update(t=>t+1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-pagination"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:7,vars:12,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","routerLink","queryParams","disabled"],[1,"join-item","btn",3,"btn-primary","routerLink","queryParams"],[1,"join-item","btn",3,"click","routerLink","queryParams"]],template:function(e,n){e&1&&(l(0,"div",0)(1,"button",1),g("click",function(){return n.previousPage()}),a(2,"\xAB"),o(),N(3,qe,2,8,"button",2,de),l(5,"button",1),g("click",function(){return n.nextPage()}),a(6,"\xBB"),o()()),e&2&&(r(),f("routerLink",y(6,le))("queryParams",A(7,me,n.activePage()-1))("disabled",n.activePage()===1),r(2),D(n.getPagesList()),r(2),f("routerLink",y(9,le))("queryParams",A(10,me,n.activePage()+1))("disabled",n.activePage()===n.pages()))},dependencies:[U],encapsulation:2})};var Q=class i{simpsonsCount=T.required();totalPages=T.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"The Simpsons"),d(),c(5,"p",4),a(6," Explora el universo de la familia m\xE1s famosa de Springfield "),d(),c(7,"div",5)(8,"div",6)(9,"div",7),w(),c(10,"svg",8),L(11,"path",9),d()(),R(),c(12,"div",10),a(13,"Personajes"),d(),c(14,"div",11),a(15),d(),c(16,"div",12),a(17,"Total de registros"),d()(),c(18,"div",6)(19,"div",13),w(),c(20,"svg",8),L(21,"path",14),d()(),R(),c(22,"div",10),a(23,"P\xE1ginas"),d(),c(24,"div",15),a(25),d(),c(26,"div",12),a(27,"Total disponibles"),d()()()()()()),e&2&&(r(15),M(" ",n.simpsonsCount()," "),r(10),S(n.totalPages()))},encapsulation:2})};var He=(i,t)=>t.label;function $e(i,t){if(i&1&&(c(0,"a",1),a(1),d()),i&2){let e=m().$implicit;pe("href",e.link,$),r(),S(e.label)}}function Ge(i,t){if(i&1&&(c(0,"span"),a(1),d()),i&2){let e=m().$implicit;r(),S(e.label)}}function Oe(i,t){if(i&1&&(c(0,"li"),u(1,$e,2,2,"a",1)(2,Ge,2,1,"span"),d()),i&2){let e=t.$implicit;r(),v(e.link?1:2)}}var X=class i{items=T([]);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-breadcrumbs"]],inputs:{items:[1,"items"]},decls:4,vars:0,consts:[[1,"breadcrumbs","text-sm","px-6","py-3","bg-base-200"],[1,"link","link-hover",3,"href"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"ul"),N(2,Oe,3,1,"li",null,He),d()()),e&2&&(r(2),D(n.items()))},encapsulation:2})};function Ue(i,t){if(i&1){let e=k();c(0,"div",0)(1,"button",1),ue("click",function(){b(e);let s=m();return x(s.scrollToTop())}),w(),c(2,"svg",2),L(3,"path",3),d()()()}}var Z=class i{isVisible=_(!1);onScroll(){this.isVisible.set(window.scrollY>300)}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-back-to-top"]],hostBindings:function(e,n){e&1&&g("scroll",function(){return n.onScroll()},ce)},decls:1,vars:1,consts:[[1,"fixed","bottom-6","right-6","z-50"],["aria-label","Volver arriba",1,"btn","btn-circle","btn-primary","shadow-lg",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 10l7-7m0 0l7 7m-7-7v18"]],template:function(e,n){e&1&&u(0,Ue,4,0,"div",0),e&2&&v(n.isVisible()?0:-1)},encapsulation:2})};var ee=class i{firestore=F(Se);authService=F(W);favorites=_([]);loading=_(!1);addFavorite(t,e,n){let s=this.authService.currentUser();if(!s)throw new Error("Usuario no autenticado");let p={nombre:t,customName:n||t,image:e,userId:s.uid,createdAt:new Date},E=ae(this.firestore,"favorites");return V(Ee(E,ne(ie({},p),{createdAt:Ce.fromDate(p.createdAt)})))}getFavorites(){let t=this.authService.currentUser();if(!t)return this.favorites.set([]),V([[]]);this.loading.set(!0);let e=ae(this.firestore,"favorites"),n=ye(e,we("userId","==",t.uid));return V(ke(n)).pipe(j(s=>{let p=s.docs.map(E=>{let te=E.data();return ne(ie({id:E.id},te),{createdAt:te.createdAt?.toDate?te.createdAt.toDate():new Date})});return this.favorites.set(p),this.loading.set(!1),p}))}updateFavorite(t,e){let n=re(this.firestore,"favorites",t);return V(Te(n,{customName:e}))}deleteFavorite(t){let e=re(this.firestore,"favorites",t);return V(Pe(e))}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=H({token:i,factory:i.\u0275fac,providedIn:"root"})};var We=()=>({label:"Inicio",link:"/"}),Ye=()=>({label:"Simpsons",link:"/simpsons"}),Je=()=>({label:"Personajes"}),Ke=(i,t,e)=>[i,t,e],Qe=i=>["/simpson-page/",i],ze=(i,t)=>t.id;function Xe(i,t){i&1&&(l(0,"div",3),h(1,"span",14),o())}function Ze(i,t){if(i&1&&(l(0,"div",4),h(1,"app-pagination",15)(2,"div",16),o()),i&2){let e=m();r(),f("pages",e.simpsonsResource.hasValue()?e.simpsonsResource.value().pages:0)("currentPage",e.paginationService.currentPage())}}function et(i,t){i&1&&(l(0,"button",18),a(1,"\u2B50 En favoritos"),o())}function tt(i,t){if(i&1){let e=k();l(0,"button",21),g("click",function(){b(e);let s=m().$implicit,p=m(2);return x(p.addToFavorites(s))}),a(1," \u2B50 Agregar "),o()}}function it(i,t){if(i&1&&(l(0,"tr")(1,"td"),u(2,et,2,0,"button",18)(3,tt,2,0,"button",19),o(),l(4,"td"),a(5),o(),l(6,"td"),a(7),o(),l(8,"td"),a(9),o(),l(10,"td")(11,"span"),a(12),o()(),l(13,"td")(14,"a",20),a(15," Ver Detalle "),o()()()),i&2){let e=t.$implicit,n=m(2);r(2),v(n.isFavorite(e.name)?2:3),r(3),S(e.id),r(2),S(e.name),r(2),S(e.occupation),r(2),ve(ge("badge badge-",e.status==="Alive"?"success":"error")),r(),M(" ",e.status," "),r(2),f("routerLink",A(9,Qe,e.id))}}function nt(i,t){if(i&1&&(l(0,"div",5)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),a(5,"ID"),o(),l(6,"th"),a(7,"Nombre"),o(),l(8,"th"),a(9,"Ocupaci\xF3n"),o(),l(10,"th"),a(11,"Estado"),o(),h(12,"th"),o()(),l(13,"tbody"),N(14,it,16,11,"tr",null,ze),o()()()),i&2){let e=m();r(14),D(e.simpsonsResource.value().results)}}function ot(i,t){i&1&&h(0,"span",10)}function at(i,t){i&1&&a(0," \u{1F504} Actualizar ")}function rt(i,t){i&1&&(l(0,"div",11),h(1,"span",14),o())}function st(i,t){i&1&&(l(0,"div",12),w(),l(1,"svg",22),h(2,"path",23),o(),R(),l(3,"span"),a(4,"No tienes favoritos a\xFAn. \xA1Agrega algunos personajes!"),o()())}function lt(i,t){i&1&&a(0," El nombre es requerido ")}function mt(i,t){i&1&&a(0," M\xEDnimo 2 caracteres ")}function ct(i,t){if(i&1&&(l(0,"span",31),u(1,lt,1,0)(2,mt,1,0),o()),i&2){let e,n=m(4);r(),v((e=n.editForm.get("customName"))!=null&&e.hasError("required")?1:(e=n.editForm.get("customName"))!=null&&e.hasError("minlength")?2:-1)}}function dt(i,t){if(i&1){let e=k();l(0,"form",29)(1,"input",30),g("keyup.enter",function(){b(e);let s=m(3);return x(s.saveEditedFavorite())})("keyup.escape",function(){b(e);let s=m(3);return x(s.cancelEditingFavorite())}),o(),u(2,ct,3,1,"span",31),l(3,"div",32)(4,"button",33),g("click",function(){b(e);let s=m(3);return x(s.saveEditedFavorite())}),a(5," \u2713 Guardar "),o(),l(6,"button",34),g("click",function(){b(e);let s=m(3);return x(s.cancelEditingFavorite())}),a(7," \u2715 Cancelar "),o()()()}if(i&2){let e,n,s=m(3);f("formGroup",s.editForm),r(),G("input-error",((e=s.editForm.get("customName"))==null?null:e.invalid)&&((e=s.editForm.get("customName"))==null?null:e.touched)),r(),v((n=s.editForm.get("customName"))!=null&&n.invalid&&((n=s.editForm.get("customName"))!=null&&n.touched)?2:-1),r(2),f("disabled",s.editForm.invalid)}}function pt(i,t){if(i&1){let e=k();l(0,"p",35)(1,"span",36),a(2,"Nombre personalizado:"),o(),h(3,"br"),a(4),o(),l(5,"div",37)(6,"button",38),g("click",function(){b(e);let s=m().$implicit,p=m(2);return x(p.startEditingFavorite(s))}),a(7," \u270F\uFE0F Editar "),o(),l(8,"button",39),g("click",function(){b(e);let s=m().$implicit,p=m(2);return x(p.removeFromFavorites(s.id))}),a(9," \u{1F5D1}\uFE0F Eliminar "),o()()}if(i&2){let e=m().$implicit;r(4),M(" ",e.customName," ")}}function ut(i,t){if(i&1&&(l(0,"div",24)(1,"figure",25),h(2,"img",26),o(),l(3,"div",27)(4,"h3",28),a(5),o(),u(6,dt,8,5,"form",29)(7,pt,10,1),o()()),i&2){let e=t.$implicit,n=m(2);r(2),f("src",e.image,$)("alt",e.nombre),r(3),S(e.nombre),r(),v(n.editingFavoriteId()===e.id?6:7)}}function vt(i,t){if(i&1&&(l(0,"div",13),N(1,ut,8,4,"div",24,ze),o()),i&2){let e=m();r(),D(e.favorites())}}var Le=class i{simpsonsService=F(Re);paginationService=F(Y);favoritesService=F(ee);authService=F(W);fb=F(Be);addFavoriteAction=_(null);deleteFavoriteAction=_(null);updateFavoriteAction=_(null);charactersPerPage=_(10);totalPages=_(0);constructor(){oe(()=>{this.simpsonsResource.hasValue()&&this.totalPages.set(this.simpsonsResource.value().pages)}),this.editForm=this.fb.group({customName:["",[se.required,se.minLength(2)]]}),oe(()=>{this.authService.currentUser()&&this.reloadFavoritesTrigger.update(e=>e+1)})}simpsonsResource=I({params:()=>({page:this.paginationService.currentPage(),limit:this.charactersPerPage()}),stream:({params:t})=>this.simpsonsService.getCharactersOptions({offset:t.page,limit:t.limit})});reloadFavoritesTrigger=_(0);favoritesResource=I({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:({params:t})=>this.authService.currentUser()?this.favoritesService.getFavorites():P([])});addFavoriteResource=I({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe(q(()=>{O(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),z(e=>(console.error("Error al agregar favorito:",e),alert("Error al agregar a favoritos: "+e.message),P(null)))):P(null)});deleteFavoriteResource=I({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe(q(()=>{O(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),z(e=>(console.error("Error al eliminar favorito:",e),P(null)))):P(null)});updateFavoriteResource=I({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe(q(()=>{O(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),z(e=>(console.error("Error al actualizar favorito:",e),P(null)))):P(null)});editingFavoriteId=_(null);editForm;favorites=()=>this.favoritesResource.value()||[];loadingFavorites=this.favoritesResource.isLoading;reloadFavorites(){this.reloadFavoritesTrigger.update(t=>t+1)}addToFavorites(t){let e=t.name||t.name,n="https://cdn.thesimpsonsapi.com/500"+t.portrait_path||"";if(!e){console.error("Nombre del personaje no encontrado"),alert("Error: No se pudo obtener el nombre del personaje");return}this.addFavoriteAction.set({nombre:e,imagen:n})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-simpsons-page"]],decls:18,vars:16,consts:[[3,"items"],[1,"p-8"],[3,"simpsonsCount","totalPages"],[1,"flex","justify-center","items-center","h-64"],[1,"flex","gap-2","items-center","h-20","mb-4"],[1,"overflow-x-auto"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-2xl","font-bold"],[1,"btn","btn-sm","btn-ghost",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"loading","loading-spinner","loading-lg"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table"],["disabled","",1,"btn","btn-sm","btn-ghost"],[1,"btn","btn-sm","btn-primary"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],[1,"btn","btn-sm","btn-primary",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-base-100","shadow-xl"],[1,"px-4","pt-4"],[1,"rounded-xl","h-32","w-auto","object",3,"src","alt"],[1,"card-body"],[1,"card-title","text-sm"],[1,"form-control",3,"formGroup"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm",3,"keyup.enter","keyup.escape"],[1,"text-error","text-xs","mt-1"],[1,"flex","gap-2","mt-2"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click","disabled"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-70"],[1,"font-semibold"],[1,"card-actions","justify-end","mt-2"],[1,"btn","btn-xs","btn-ghost",3,"click"],[1,"btn","btn-xs","btn-error",3,"click"]],template:function(e,n){if(e&1&&(h(0,"app-breadcrumbs",0),l(1,"section",1),h(2,"app-hero-simpsons",2),u(3,Xe,2,0,"div",3),u(4,Ze,3,2,"div",4),u(5,nt,16,0,"div",5),o(),l(6,"section")(7,"div",6)(8,"div",7)(9,"h2",8),a(10,"\u2B50 Mis Favoritos"),o(),l(11,"button",9),g("click",function(){return n.reloadFavorites()}),u(12,ot,1,0,"span",10)(13,at,1,0),o()(),u(14,rt,2,0,"div",11)(15,st,5,0,"div",12)(16,vt,3,0,"div",13),o()(),h(17,"app-back-to-top")),e&2){let s;f("items",_e(12,Ke,y(9,We),y(10,Ye),y(11,Je))),r(2),f("simpsonsCount",((s=n.simpsonsResource.value())==null?null:s.count)??0)("totalPages",n.totalPages()),r(),v(n.simpsonsResource.isLoading()?3:-1),r(),v(n.simpsonsResource.hasValue()?4:-1),r(),v(n.simpsonsResource.hasValue()?5:-1),r(6),f("disabled",n.loadingFavorites()),r(),v(n.loadingFavorites()?12:13),r(2),v(n.loadingFavorites()?14:n.favorites().length===0?15:16)}},dependencies:[U,J,Q,X,Z,je,Ve,Ne,De,Me,Ae,Ie,xe],encapsulation:2})};export{Le as SimpsonsPage};
